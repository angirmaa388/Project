<!-- Author: Angirmaa Ganbat x24177032 -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
   <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <title>createpost page</title>
  </head>
  <body>

   <div class="newPost">
    <form id = "postForm">
      <div class="form-floating">
        <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea"></textarea>
        <label for="floatingTextarea"></label>
      </div>
      <div>
          <label for="file">File</label>
          <input id="file" name="file" type="file"/>
          <br/><br/>
          <div class="col-12">
            <button class="btn btn-primary" type="submit">Submit</button>
          </div>
        </form>
      </div>
   </div>
   <script>
    const postForm = document.querySelector('#postForm');
    //selecting the postForm 
    const file = document.getElementById("file");
    postForm.addEventListener('submit', event => {
      event.preventDefault();

    const formData = new FormData();
    formData.append("postText", document.getElementById("floatingTextarea").value);


      if(file.files.length){
        formData.append("file", file.files[0]); 
      }  
      //it will help to send the file to the server 

      formData.append("userId", localStorage.getItem('userId'));
      //appending the data and userid 

      fetch('http://localhost:8086/api/v1/posts', {
        method: 'POST', 
        headers: { Authorization:'Bearer ' + localStorage.getItem('token') },
        body: formData
        //posting it to the server 
      }).then(res => {
        if(res.ok) {
          //if it post the data successfully 
          //it will show alert message 
          //and load the home page 
          alert("post successfully created!");
           window.location.href = "home.html"
        }else{
          alert("post submit failed!");
          //else give an error message 
        }
      })
        .catch(error => alert("network error!"));
      });
</script>
  </body>
</html>