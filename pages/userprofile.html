<!-- Author: Angirmaa Ganbat x24177032 -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
  <title>User profile</title>
  <style>
    #UserInfo .userName { 
      font-size: 25px !important; 
      font-family:'Roboto', sans-serif !important; 
      color:navy !important;
    }

    #UserInfo .email { 
      font-size: 18px !important; 
      font-family:'Roboto', sans-serif !important; 
      
    }
    #UserInfo .status { 
      font-size: 18px !important; 
      font-family:'Roboto', sans-serif !important; 
      
    }


  </style>
  </head>
  <body class="body">
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <!-- Logo image-->
        <a class="navbar-brand" href="home.html">
          <img src="../imgs/logo.png" alt="Logo" width="150">
        </a>

         
      </div>
    </nav>
<!-- main part starts-->
     
        <section class="vh-100" style="background-color: #EDF0F5;">
          <div class="container py-5 h-150" >
            <div class="row d-flex justify-content-center align-items-center h-100">
              <div class="col col-xl-12">
                    <div class="card mb-5" style="border-radius: 15px; min-height: 300px;">
                      <div class="card-body p-4" id="UserInfo">
                        
                      </div>
                      
                    </div>
                </div>
              </div>
            </div>
        </section>

<!-- main part finishes-->


    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      //selecting all the user information 
      async function getUserProfileInfo() {
      const UserInformation = document.getElementById("UserInfo")
      const token = localStorage.getItem("token");
      const userId = localStorage.getItem("userId");
      
  try {
    const response = await fetch(`http://localhost:8086/api/v1/users/${userId}`, {
     //fetch the user information by userId
      headers: {
        "Authorization": `Bearer ${token}`
        //checking the token 
      }
    });
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
    }
    //if the response not ok there will an error message  
    const result = await response.json();
    const newDiv = document.createElement("div");
    //if it gets the information, it will put them in the new div 
    let fileHtml="";
    newDiv.innerHTML = 
      `<h1 class="mb-3 userName" >${result.userName}</h1>
      <p class="small mb-3" email >Email: ${result.email}</p>
      <p class="small mb-3" status >Status: ${result.status}</p> 
      `;
      
       UserInformation.prepend(newDiv);
     
    console.log(result);
  } catch (error) {
    console.error("Fetch error:", error);
  }
}
    </script>
    <script>
      //window will load to get user profile info 
      window.onload=function(){
      getUserProfileInfo()
    }
    </script>
    <script>
    const logOutButton = document.querySelector('.logOut');
    // selecting the log out by querySelector 

    logOutButton.addEventListener('click', event => {
      event.preventDefault();
      //using eventlistener to perform the log out button  
      const token = localStorage.getItem("token");

      fetch('http://localhost:8086/api/v1/auth/logOut', {
        //here it will fetch the log out request 
        method: 'POST', 
        headers: {
          'Content-Type': 'application/json',
          "Authorization": `Bearer ${token}`

        }, 
        //checking this with the token 
      }).then(response => {
        if(response.ok) {
          localStorage.removeItem('token');
          localStorage.removeItem('userId');
           window.location.href = "../index.html"
           //if the response ok, local storage remove the token then 
           //it will load the index.html window 
        }else{
          alert("Log out failed!");
          //if the request failed there will be alert message request failed 
        }
      })
        .catch(error => alert("network error!"));
      });
  </script>
 
  </body>
</html>


